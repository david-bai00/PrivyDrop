# PrivyDrop Docker éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—æä¾› PrivyDrop çš„ Docker ä¸€é”®éƒ¨ç½²æ–¹æ¡ˆï¼Œæ”¯æŒå†…ç½‘å’Œå…¬ç½‘ç¯å¢ƒï¼Œæ— éœ€å¤æ‚çš„æ‰‹åŠ¨é…ç½®ã€‚

## ğŸ¯ éƒ¨ç½²ä¼˜åŠ¿

ç›¸æ¯”ä¼ ç»Ÿéƒ¨ç½²æ–¹å¼ï¼ŒDocker éƒ¨ç½²å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

| å¯¹æ¯”é¡¹ç›® | ä¼ ç»Ÿéƒ¨ç½² | Docker éƒ¨ç½² |
|---------|---------|------------|
| **éƒ¨ç½²æ—¶é—´** | 30-60åˆ†é’Ÿ | 5åˆ†é’Ÿ |
| **æŠ€æœ¯è¦æ±‚** | Linuxè¿ç»´ç»éªŒ | ä¼šç”¨Dockerå³å¯ |
| **ç¯å¢ƒè¦æ±‚** | å…¬ç½‘IP + åŸŸå | å†…ç½‘å³å¯ä½¿ç”¨ |
| **é…ç½®å¤æ‚åº¦** | 10+ä¸ªæ‰‹åŠ¨æ­¥éª¤ | ä¸€é”®è‡ªåŠ¨é…ç½® |
| **æˆåŠŸç‡** | ~70% | >95% |
| **ç»´æŠ¤éš¾åº¦** | éœ€è¦æ‰‹åŠ¨ç®¡ç†å¤šä¸ªæœåŠ¡ | å®¹å™¨è‡ªåŠ¨ç®¡ç† |

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### æœ€ä½é…ç½®
- **CPU**: 1æ ¸
- **å†…å­˜**: 512MB
- **ç£ç›˜**: 2GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ä»»æ„ç½‘ç»œç¯å¢ƒï¼ˆå†…ç½‘/å…¬ç½‘å‡å¯ï¼‰

### æ¨èé…ç½®
- **CPU**: 2æ ¸åŠä»¥ä¸Š
- **å†…å­˜**: 1GBåŠä»¥ä¸Š
- **ç£ç›˜**: 5GBåŠä»¥ä¸Šå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: 100MbpsåŠä»¥ä¸Š

### è½¯ä»¶ä¾èµ–
- Docker 20.10+
- Docker Compose 2.0+ (æˆ– docker-compose 1.27+)
- curl (ç”¨äºå¥åº·æ£€æŸ¥)
- openssl (ç”¨äºSSLè¯ä¹¦ç”Ÿæˆ)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è·å–ä»£ç 

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/david-bai00/PrivyDrop.git
cd PrivyDrop
```

### 2. ä¸€é”®éƒ¨ç½²

```bash
# åŸºç¡€éƒ¨ç½² (æ¨èæ–°æ‰‹)
bash deploy.sh

# ç­‰å¾…éƒ¨ç½²å®Œæˆåè®¿é—®
# http://localhost:3000
```

å°±æ˜¯è¿™ä¹ˆç®€å•ï¼ğŸ‰

## ğŸ“š éƒ¨ç½²æ¨¡å¼è¯¦è§£

### åŸºç¡€æ¨¡å¼ (é»˜è®¤)
**é€‚ç”¨åœºæ™¯**: å†…ç½‘æ–‡ä»¶ä¼ è¾“ã€ä¸ªäººä½¿ç”¨ã€æµ‹è¯•ç¯å¢ƒ

```bash
bash deploy.sh
```

**ç‰¹æ€§**:
- âœ… HTTP è®¿é—®
- âœ… å†…ç½‘ P2P ä¼ è¾“
- âœ… ä½¿ç”¨å…¬å…± STUN æœåŠ¡å™¨
- âœ… é›¶é…ç½®å¯åŠ¨

### å…¬ç½‘æ¨¡å¼
**é€‚ç”¨åœºæ™¯**: æœ‰å…¬ç½‘IPä½†æ— åŸŸåçš„æœåŠ¡å™¨

```bash
bash deploy.sh --mode public --with-turn
```

**ç‰¹æ€§**:
- âœ… HTTP è®¿é—®
- âœ… å†…ç½® TURN æœåŠ¡å™¨
- âœ… æ”¯æŒå¤æ‚ç½‘ç»œç¯å¢ƒ
- âœ… è‡ªåŠ¨é…ç½® NAT ç©¿é€

### å®Œæ•´æ¨¡å¼
**é€‚ç”¨åœºæ™¯**: ç”Ÿäº§ç¯å¢ƒã€æœ‰åŸŸåçš„å…¬ç½‘æœåŠ¡å™¨

```bash
bash deploy.sh --domain your-domain.com --mode full --with-nginx --with-turn
```

**ç‰¹æ€§**:
- âœ… HTTPS å®‰å…¨è®¿é—®
- âœ… è‡ªç­¾å SSL è¯ä¹¦
- âœ… Nginx åå‘ä»£ç†
- âœ… å†…ç½® TURN æœåŠ¡å™¨
- âœ… å®Œæ•´ç”Ÿäº§ç¯å¢ƒé…ç½®

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰ç«¯å£

```bash
# ä¿®æ”¹ .env æ–‡ä»¶
FRONTEND_PORT=8080
BACKEND_PORT=8081
HTTP_PORT=8000
```

### å¯ç”¨ç‰¹å®šæœåŠ¡

```bash
# ä»…å¯ç”¨ Nginx åå‘ä»£ç†
bash deploy.sh --with-nginx

# ä»…å¯ç”¨ TURN æœåŠ¡å™¨
bash deploy.sh --with-turn

# å¯ç”¨æ‰€æœ‰æœåŠ¡
bash deploy.sh --with-nginx --with-turn
```

### å¼€å‘æ¨¡å¼éƒ¨ç½²

```bash
# å¯ç”¨å¼€å‘æ¨¡å¼ (æ”¯æŒä»£ç çƒ­æ›´æ–°)
bash deploy.sh --dev
```

## ğŸŒ è®¿é—®æ–¹å¼

### æœ¬æœºè®¿é—®
- **å‰ç«¯åº”ç”¨**: http://localhost:3000
- **APIæ¥å£**: http://localhost:3001
- **å¥åº·æ£€æŸ¥**: http://localhost:3001/health

### å±€åŸŸç½‘è®¿é—®
éƒ¨ç½²å®Œæˆåï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ˜¾ç¤ºå±€åŸŸç½‘è®¿é—®åœ°å€ï¼š
```
ğŸŒ å±€åŸŸç½‘è®¿é—®ï¼š
   å‰ç«¯åº”ç”¨: http://192.168.1.100:3000
   åç«¯API: http://192.168.1.100:3001
```

### HTTPSè®¿é—® (å¦‚æœå¯ç”¨)
- **å®‰å…¨è®¿é—®**: https://localhost
- **è¯ä¹¦ä½ç½®**: `docker/ssl/ca-cert.pem`

**æ³¨æ„**: é¦–æ¬¡è®¿é—®HTTPSæ—¶ï¼Œæµè§ˆå™¨ä¼šæç¤ºè¯ä¹¦ä¸å—ä¿¡ä»»ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚å¯ä»¥ï¼š
1. ç‚¹å‡»"é«˜çº§" â†’ "ç»§ç»­è®¿é—®"
2. æˆ–å¯¼å…¥ `docker/ssl/ca-cert.pem` è¯ä¹¦åˆ°æµè§ˆå™¨

## ğŸ” ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
docker-compose ps
```

### æŸ¥çœ‹æœåŠ¡æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f redis
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart backend
```

### åœæ­¢æœåŠ¡
```bash
# åœà¸´æ­¢æœåŠ¡ä½†ä¿ç•™æ•°æ®
docker-compose stop

# åœæ­¢æœåŠ¡å¹¶åˆ é™¤å®¹å™¨
docker-compose down
```

### å®Œå…¨æ¸…ç†
```bash
# æ¸…ç†æ‰€æœ‰å®¹å™¨ã€é•œåƒå’Œæ•°æ®
bash deploy.sh --clean
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£è¢«å ç”¨
**ç°è±¡**: éƒ¨ç½²æ—¶æç¤ºç«¯å£å·²è¢«å ç”¨
```
âš ï¸  ä»¥ä¸‹ç«¯å£å·²è¢«å ç”¨: 3000, 3001
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹æ³•1: ä¿®æ”¹ç«¯å£é…ç½®
echo "FRONTEND_PORT=8080" >> .env
echo "BACKEND_PORT=8081" >> .env

# æ–¹æ³•2: åœæ­¢å ç”¨ç«¯å£çš„ç¨‹åº
sudo ss -tulpn | grep :3000
sudo kill -9 <PID>
```

#### 2. å†…å­˜ä¸è¶³
**ç°è±¡**: å®¹å™¨å¯åŠ¨å¤±è´¥æˆ–é¢‘ç¹é‡å¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h

# æ·»åŠ äº¤æ¢ç©ºé—´ (ä¸´æ—¶è§£å†³)
sudo fallocate -l 1G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

#### 3. Dockeræƒé™é—®é¢˜
**ç°è±¡**: æç¤ºæƒé™ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å°†ç”¨æˆ·æ·»åŠ åˆ°dockerç»„
sudo usermod -aG docker $USER

# é‡æ–°ç™»å½•æˆ–åˆ·æ–°ç»„æƒé™
newgrp docker
```

#### 4. æœåŠ¡æ— æ³•è®¿é—®
**ç°è±¡**: æµè§ˆå™¨æ— æ³•æ‰“å¼€é¡µé¢

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps

# 2. æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:3001/health
curl http://localhost:3000/api/health

# 3. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs -f

# 4. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
```

#### 5. WebRTCè¿æ¥å¤±è´¥
**ç°è±¡**: æ— æ³•å»ºç«‹P2Pè¿æ¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å¯ç”¨TURNæœåŠ¡å™¨
bash deploy.sh --with-turn

# æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -I http://localhost:3001/api/get_room
```

### å¥åº·æ£€æŸ¥

é¡¹ç›®æä¾›äº†å®Œæ•´çš„å¥åº·æ£€æŸ¥åŠŸèƒ½ï¼š

```bash
# è¿è¡Œå¥åº·æ£€æŸ¥æµ‹è¯•
bash test-health-apis.sh

# æ‰‹åŠ¨æ£€æŸ¥å„æœåŠ¡
curl http://localhost:3001/health          # åç«¯åŸºç¡€æ£€æŸ¥
curl http://localhost:3001/health/detailed # åç«¯è¯¦ç»†æ£€æŸ¥
curl http://localhost:3000/api/health      # å‰ç«¯æ£€æŸ¥
```

### æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
docker system df

# æ¸…ç†æœªä½¿ç”¨çš„èµ„æº
docker system prune -f
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

1. **å¯ç”¨ Nginx ç¼“å­˜**:
```bash
bash deploy.sh --with-nginx
```

2. **é…ç½®èµ„æºé™åˆ¶**:
```yaml
# åœ¨ docker-compose.yml ä¸­æ·»åŠ 
services:
  backend:
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 128M
```

3. **å¯ç”¨æ—¥å¿—è½®è½¬**:
```bash
# é…ç½®æ—¥å¿—å¤§å°é™åˆ¶
echo '{"log-driver":"json-file","log-opts":{"max-size":"10m","max-file":"3"}}' | sudo tee /etc/docker/daemon.json
sudo systemctl restart docker
```

### ç½‘ç»œä¼˜åŒ–

1. **ä½¿ç”¨ä¸“ç”¨ç½‘ç»œ**:
```yaml
networks:
  privydrop-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
```

2. **å¯ç”¨ HTTP/2**:
```bash
# è‡ªåŠ¨å¯ç”¨ (éœ€è¦ HTTPS)
bash deploy.sh --mode full --with-nginx
```

## ğŸ”’ å®‰å…¨é…ç½®

### SSL/TLSé…ç½®

1. **è‡ªç­¾åè¯ä¹¦** (é»˜è®¤):
   - è‡ªåŠ¨ç”Ÿæˆå’Œé…ç½®
   - é€‚ç”¨äºå†…ç½‘å’Œæµ‹è¯•ç¯å¢ƒ
   - è¯ä¹¦ä½ç½®: `docker/ssl/`

2. **Let's Encryptè¯ä¹¦** (è®¡åˆ’ä¸­):
   - è‡ªåŠ¨ç”³è¯·å’Œç»­æœŸ
   - é€‚ç”¨äºæœ‰åŸŸåçš„ç”Ÿäº§ç¯å¢ƒ

### ç½‘ç»œå®‰å…¨

1. **é˜²ç«å¢™é…ç½®**:
```bash
# Ubuntu/Debian
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 3478/udp  # TURNæœåŠ¡å™¨
```

2. **å®¹å™¨ç½‘ç»œéš”ç¦»**:
   - æ‰€æœ‰æœåŠ¡è¿è¡Œåœ¨ç‹¬ç«‹ç½‘ç»œä¸­
   - ä»…æš´éœ²å¿…è¦ç«¯å£
   - å†…éƒ¨æœåŠ¡ä½¿ç”¨å®¹å™¨åé€šä¿¡

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—ç®¡ç†

æ‰€æœ‰æœåŠ¡æ—¥å¿—ç»Ÿä¸€å­˜å‚¨åœ¨ `logs/` ç›®å½•ï¼š

```
logs/
â”œâ”€â”€ nginx/          # Nginxè®¿é—®å’Œé”™è¯¯æ—¥å¿—
â”œâ”€â”€ backend/        # åç«¯åº”ç”¨æ—¥å¿—
â”œâ”€â”€ frontend/       # å‰ç«¯åº”ç”¨æ—¥å¿—
â””â”€â”€ coturn/         # TURNæœåŠ¡å™¨æ—¥å¿—
```

### ç›‘æ§é›†æˆ (å¯é€‰)

å¯ä»¥é›†æˆ Prometheus + Grafana ç›‘æ§æ ˆï¼š

```bash
# å¯ç”¨ç›‘æ§ (è®¡åˆ’ä¸­)
bash deploy.sh --with-monitoring
```

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### æ›´æ–°åº”ç”¨

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°éƒ¨ç½²
bash deploy.sh
```

### æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½Redisæ•°æ®
docker-compose exec redis redis-cli BGSAVE

# å¤‡ä»½SSLè¯ä¹¦
tar -czf ssl-backup.tar.gz docker/ssl/

# å¤‡ä»½é…ç½®æ–‡ä»¶
cp .env .env.backup
```

### å®šæœŸç»´æŠ¤

```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒå’Œå®¹å™¨
docker system prune -f

# æ›´æ–°åŸºç¡€é•œåƒ
docker-compose pull
docker-compose up -d
```

## ğŸ†˜ è·å–å¸®åŠ©

### å‘½ä»¤è¡Œå¸®åŠ©
```bash
bash deploy.sh --help
```

### åœ¨çº¿èµ„æº
- [é¡¹ç›®ä¸»é¡µ](https://github.com/david-bai00/PrivyDrop)
- [åœ¨çº¿æ¼”ç¤º](https://www.privydrop.app/)
- [é—®é¢˜åé¦ˆ](https://github.com/david-bai00/PrivyDrop/issues)

### ç¤¾åŒºæ”¯æŒ
- GitHub Issues: æŠ€æœ¯é—®é¢˜å’ŒbugæŠ¥å‘Š
- GitHub Discussions: ä½¿ç”¨äº¤æµå’ŒåŠŸèƒ½å»ºè®®

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (DockeråŒ–ç‰ˆæœ¬)
- âœ… æ–°å¢ Docker ä¸€é”®éƒ¨ç½²æ”¯æŒ
- âœ… æ–°å¢å¥åº·æ£€æŸ¥API
- âœ… æ–°å¢è‡ªåŠ¨ç¯å¢ƒæ£€æµ‹å’Œé…ç½®ç”Ÿæˆ
- âœ… æ–°å¢å¤šç§éƒ¨ç½²æ¨¡å¼
- âœ… æ–°å¢å®Œæ•´çš„æ•…éšœæ’é™¤æŒ‡å—
- âœ… æ”¯æŒå†…ç½‘éƒ¨ç½²ï¼Œæ— éœ€å…¬ç½‘IP

---

**ğŸ‰ æ­å–œï¼ä½ å·²ç»æˆåŠŸéƒ¨ç½²äº† PrivyDropã€‚å¼€å§‹äº«å—å®‰å…¨ã€ç§å¯†çš„æ–‡ä»¶åˆ†äº«å§ï¼**